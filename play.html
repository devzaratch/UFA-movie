<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>Watching | UFA-MOVIE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; }
        .nav-back { padding: 15px; background: #111; }
        .player-container { max-width: 1000px; margin: 20px auto; padding: 0 15px; position: relative; }
        
        /* AD OVERLAY */
        .ad-layer { position: absolute; top: 0; left: 15px; right: 15px; bottom: 0; background: rgba(0,0,0,0.95); z-index: 100; display: flex; align-items: center; justify-content: center; border-radius: 10px; }
        .btn-skip { position: absolute; bottom: 50px; right: 30px; background: #333; color: #fff; border: 1px solid #777; padding: 12px 25px; border-radius: 5px; cursor: not-allowed; }
        .btn-skip.ready { background: #e50914; cursor: pointer; border-color: #fff; }
        .btn-reg { position: absolute; top: 30px; right: 30px; background: #f5c518; color: #000; padding: 10px 20px; text-decoration: none; font-weight: bold; border-radius: 5px; }

        .artplayer-app { width: 100%; aspect-ratio: 16/9; border-radius: 10px; overflow: hidden; }
        .ep-list { margin-top: 20px; background: #1a1c22; border-radius: 8px; }
        .ep-item { padding: 15px; border-bottom: 1px solid #333; cursor: pointer; }
        .ep-item.active { background: #222; border-left: 4px solid red; color: red; }
    </style>
</head>
<body>
    <div class="nav-back"><a href="index.html" style="color:red; text-decoration:none;">← กลับหน้าแรก</a></div>
    
    <div class="player-container">
        <div id="adLayer" class="ad-layer">
            <video id="adVideo" autoplay>
                <source src="UFA.mp4" type="video/mp4">
            </video>
            <a href="https://ufasboclubauto.com/register" class="btn-reg">สมัครสมาชิก</a>
            <button id="skipBtn" class="btn-skip" disabled>รอ <span id="timer">3</span> วิ</button>
        </div>

        <div class="artplayer-app"></div>
        <h1 id="m-title" style="margin:20px 0 10px;"></h1>
        
        <div class="ep-list" id="epBox" style="display:none;">
            <div style="padding:15px; background:#333; font-weight:bold;">เลือกตอนรับชม</div>
            <div id="epItems"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/artplayer/dist/artplayer.js"></script>
    <script src="data.js"></script>
    <script>
        const id = new URLSearchParams(window.location.search).get('id');
        const m = movieDatabase.find(x => x.id === id);
        let cur = 0;

        if (m) {
            document.getElementById('m-title').innerText = m.title;
            const startUrl = m.type === 'series' ? m.episodes[0].url : m.url;

            const art = new Artplayer({
                container: '.artplayer-app',
                url: startUrl,
                type: 'm3u8',
                pip: true,
                setting: true,
                fullscreen: true,
                controls: m.type === 'series' ? [{
                    position: 'right',
                    html: '<i class="fas fa-step-forward"></i>',
                    click: () => changeEp(cur + 1)
                }] : [],
                customType: {
                    m3u8: (video, url) => {
                        const hls = new Hls();
                        hls.loadSource(url);
                        hls.attachMedia(video);
                    }
                }
            });

            // AD TIMER LOGIC
            let count = 3;
            const t = setInterval(() => {
                count--;
                if(count > 0) document.getElementById('timer').innerText = count;
                else {
                    clearInterval(t);
                    const b = document.getElementById('skipBtn');
                    b.innerText = "ข้ามโฆษณา"; b.disabled = false; b.classList.add('ready');
                }
            }, 1000);

            document.getElementById('skipBtn').onclick = function() {
                const adVideo = document.getElementById('adVideo');
                const adLayer = document.getElementById('adLayer');

                if (adVideo) {
                    adVideo.pause();
                    adVideo.src = "";
                    adVideo.load();
                }
                adLayer.style.display = "none";
                art.play();
            };
            document.getElementById('adVideo').onended = function() {
                const adLayer = document.getElementById('adLayer');
                this.pause();
                this.src = "";
                adLayer.style.display = "none";
                art.play();
            }

            // SERIES LOGIC
            if (m.type === 'series') {
                document.getElementById('epBox').style.display = 'block';
                const box = document.getElementById('epItems');
                m.episodes.forEach((ep, i) => {
                    const d = document.createElement('div');
                    d.className = `ep-item ${i===0?'active':''}`;
                    d.innerText = ep.title;
                    d.onclick = () => changeEp(i);
                    box.appendChild(d);
                });
            }

            function changeEp(i) {
                if (i >= 0 && i < m.episodes.length) {
                    cur = i;
                    art.switchUrl(m.episodes[i].url);
                    document.querySelectorAll('.ep-item').forEach((el, idx) => el.classList.toggle('active', idx === i));
                }
            }
        }
    </script>
</body>
</html>
